!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("UIExtension")):"function"==typeof define&&define.amd?define(["UIExtension"],n):"object"==typeof exports?exports.UndoRedoAddon=n(require("UIExtension")):t.UndoRedoAddon=n(t.UIExtension)}(self,(function(t){return function(t){var n={};function e(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:o})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)e.d(o,r,function(n){return t[n]}.bind(null,r));return o},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=4)}([function(n,e){n.exports=t},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){var t={};return t.promise=new Promise((function(n,e){t.resolve=n,t.reject=e})),t}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,n){var e=[],o=!0,r=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(o=(a=u.next()).done)&&(e.push(a.value),!n||e.length!==n);o=!0);}catch(t){r=!0,i=t}finally{try{!o&&u.return&&u.return()}finally{if(r)throw i}}return e}(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=e(3),i=function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n.default=t,n}(e(0));function a(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n}function u(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):function(t,n){for(var e=Object.getOwnPropertyNames(n),o=0;o<e.length;o++){var r=e[o],i=Object.getOwnPropertyDescriptor(n,r);i&&i.configurable&&void 0===t[r]&&Object.defineProperty(t,r,i)}}(t,n))}function s(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var c=i.PDFViewCtrl.Deps.jQuery,f=i.UIEvents,l=function(){function t(n,e){s(this,t),this.pdfViewer=n,this.controller=e}return t.prototype.init=function(){var t=this.controller,n=this.pdfViewer,e=void 0,i=0,f=void 0,l=function(){e=void 0,i=0,f=void 0};n.registerMatchRule((function(d,p){function h(o,r){return t.create("annot",o,r,function(){if(i++,!e)return e=d,f||(f=n.getAllActivatedElements().map((function(t){return t.annot})).filter(Boolean)),0===f.length||-1===f.indexOf(d)?(i--,e=void 0,f=void 0):f.length===i&&l(),!1;-1===f.indexOf(d)&&i--;var t=f.length;return i===t?(l(),!0):t>1}())}return function(t){function e(){s(this,e);for(var n=arguments.length,o=Array(n),r=0;r<n;r++)o[r]=arguments[r];var i=a(this,t.call.apply(t,[this].concat(o)));return i.undoRedoDataRecord={},i}return u(e,t),e.prototype.setColor=function(n){var e=this,o=this.annot.getBorderColor();return t.prototype.setColor.call(this,n).then((function(t){var n=e.annot.getBorderColor();return h(r.ANNOTATION.SETCOLOR,{annot:e.annot,oldColor:o,newColor:n}),t}))},e.prototype.setOpacity=function(n){var e=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o&&i&&h(r.ANNOTATION.SETOPACITY,{annot:this.annot,oldOpacity:i.oldValue,newOpacity:i.commitValue});var a=this.annot.getOpacity();return t.prototype.setOpacity.call(this,n).then((function(t){var n=e.annot.getOpacity();return o&&!i&&h(r.ANNOTATION.SETOPACITY,{annot:e.annot,oldOpacity:a,newOpacity:n}),t}))},e.prototype.setFillColor=function(n){var e=this,o=this.annot.getStyleFillColor||this.annot.getFillColor,i=o.call(this.annot);return t.prototype.setFillColor.call(this,n).then((function(t){var n=o.call(e.annot);return h(r.ANNOTATION.SETFILLCOLOR,{annot:e.annot,oldFillColor:i,newFillColor:n}),t}))},e.prototype.setBorderWidth=function(n){var e=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o&&i&&h(r.ANNOTATION.SETBORDERWIDTH,{annot:this.annot,oldBorderWidth:i.oldValue,newBorderWidth:i.commitValue});var a=this.annot.getBorderWidth();return t.prototype.setBorderWidth.call(this,n).then((function(t){var n=e.annot.getBorderWidth();return o&&!i&&h(r.ANNOTATION.SETBORDERWIDTH,{annot:e.annot,oldBorderWidth:a,newBorderWidth:n}),t}))},e.prototype.setBorderStyle=function(n,e){var o=this,i=this.annot.getBorderStyleWithParam();return t.prototype.setBorderStyle.call(this,n,e).then((function(t){var n=o.annot.getBorderStyleWithParam();return h(r.ANNOTATION.SETBORDERSTYLE,{annot:o.annot,oldBorderStyle:i,newBorderStyle:n}),t}))},e.prototype.setEndingStyle=function(n,e){var o=this,i=void 0,a=(i=n?this.annot.getStartStyle||this.annot.getCalloutLineEndingStyle:this.annot.getEndingStyle).call(this.annot);return t.prototype.setEndingStyle.call(this,n,e).then((function(t){var e=i.call(o.annot);return h(r.ANNOTATION.SETENDINGSTYLE,{annot:o.annot,isStart:n,oldStyle:a,newStyle:e}),t}))},e.prototype.enableCaption=function(n){var e=this,o=this.annot.hasCaption();return t.prototype.enableCaption.call(this,n).then((function(t){var n=e.annot.hasCaption();return h(r.ANNOTATION.ENABLECAPTION,{annot:e.annot,oldEnableCaption:o,newEnableCaption:n}),t}))},e.prototype.setRotation=function(n){var e=this,o=this.annot.getRotation(),i=this.annot.getRect();return t.prototype.setRotation.call(this,n).then((function(t){var n=e.annot.getRotation(),a=e.annot.getRect();return h(r.ANNOTATION.SETROTATION,{annot:e.annot,oldRotation:o,newRotation:n,oldRect:i,newRect:a}),t}))},e.prototype.setHighlightingMode=function(n){var e=this,o=this.annot.getHighlightingMode();return t.prototype.setHighlightingMode.call(this,n).then((function(t){var n=e.annot.getHighlightingMode();return h(r.ANNOTATION.SETHIGHLIGHTINGMODE,{annot:e.annot,oldHlMode:o,newHlMode:n}),t}))},e.prototype.removeAnnot=function(){var e=this.annot,o=e.info.type,i=!("sound"===o||"widget"===o||"watermark"===o);return i&&!f&&(f=n.getAllActivatedElements().map((function(t){return t.annot})).filter(Boolean)).slice(0).forEach((function(t){var n=t.getGroupHeader&&t.getGroupHeader();if(n!==t){var e=f.indexOf(n);e>-1&&f.splice(e,1)}})),t.prototype.removeAnnot.call(this).then((function(t){return i&&t&&t.length>0&&h(r.ANNOTATION.REMOVEANNOT,[t,e]),t}))},e.prototype.textBoundaryStart=function(){this.undoRedoDataRecord[r.ANNOTATION.UPDATEQUADPOINTSBYCHARINDEX]={annot:this.annot,oldStart:this.annot.getStartCharIndex(),oldEnd:this.annot.getEndCharIndex()}},e.prototype.textBoundaryEnd=function(){var t=this.undoRedoDataRecord[r.ANNOTATION.UPDATEQUADPOINTSBYCHARINDEX],n=Object.assign({},t,{annot:this.annot,newStart:this.annot.getStartCharIndex(),newEnd:this.annot.getEndCharIndex()});h(r.ANNOTATION.UPDATEQUADPOINTSBYCHARINDEX,n)},e.prototype.onStartUpdateShape=function(n){if(this.isCallingOnShapeUpdate=!0,"resize"===n&&"freetext"===this.annot.getType()&&this.annot.getIntent&&"FreeTextCallout"===this.annot.getIntent())this.undoRedoDataRecord[r.ANNOTATION.UPDATECALLOUTPOINTS]={annot:this.annot,oldRect:this.annot.getRect(),oldCalloutLinePoints:this.annot.getCalloutLinePoints(),oldInnerRect:this.annot.getInnerRect()};else{var e=this.annot.getType();"square"===e||"circle"===e||"freetext"===e&&this.annot.getIntent&&"FreeTextTextbox"===this.annot.getIntent()?this.undoRedoDataRecord[r.ANNOTATION.SETRECT]={annot:this.annot,oldRect:this.annot.getRect(),oldInnerRect:this.annot.getInnerRect()}:this.undoRedoDataRecord[r.ANNOTATION.SETRECT]={annot:this.annot,oldRect:this.annot.getRect()}}return t.prototype.onStartUpdateShape.apply(this,arguments)},e.prototype.onShapeUpdateEnd=function(n){var e=this,o=t.prototype.onShapeUpdateEnd.apply(this,arguments);return o.finally((function(){e.isCallingOnShapeUpdate=!1})),"resize"===n&&"freetext"===this.annot.getType()&&this.annot.getIntent&&"FreeTextCallout"===this.annot.getIntent()?o.then((function(){var t=e.undoRedoDataRecord[r.ANNOTATION.UPDATECALLOUTPOINTS],n=Object.assign({},t,{annot:e.annot,newRect:e.annot.getRect(),newCalloutLinePoints:e.annot.getCalloutLinePoints(),newInnerRect:e.annot.getInnerRect()});h(r.ANNOTATION.UPDATECALLOUTPOINTS,n)})):o.then((function(){var t=e.undoRedoDataRecord[r.ANNOTATION.SETRECT],n=void 0,o=e.annot.getType();n="square"===o||"circle"===o||"freetext"===o&&e.annot.getIntent&&"FreeTextTextbox"===e.annot.getIntent()?Object.assign({},t,{annot:e.annot,newRect:e.annot.getRect(),newInnerRect:e.annot.getInnerRect()}):Object.assign({},t,{annot:e.annot,newRect:e.annot.getRect()}),h(r.ANNOTATION.SETRECT,n)}))},e.prototype.moveTo=function(n,e,i,a){var u=this,s=this.annot.getRect(),c=this.getPDFPage(),f=c.reverseDevicePoint([n,e],this.scale,this.rotate),l=o(f,2),d=l[0],p=l[1],T=t.prototype.moveTo.apply(this,arguments);return T.then((function(t){return u.isCallingOnShapeUpdate||h(r.ANNOTATION.MOVETO,{annot:u.annot,originLeft:s.left,originTop:s.top,left:d,top:p,action:i,apply:a}),t}))},e.prototype.setRect=function(n){var e=this,o=this.annot.getRect(),i=this.getPDFPage(),a=i.reverseDeviceRect({left:n.left,top:n.top,right:n.left+n.width,bottom:n.top+n.height},this.scale,this.rotate),u=t.prototype.setRect.apply(this,arguments);return u.then((function(t){return e.isCallingOnShapeUpdate||h(r.ANNOTATION.ANNOT_SET_RECT,{annot:e.annot,originRect:o,newRect:a}),t}))},e.prototype.boundaryChangeStart=function(t){if("line"===this.annot.getType())switch(c(t.target).data("index")){case 0:case 1:this.undoRedoDataRecord[r.ANNOTATION.UPDATELINEPOINTS]={annot:this.annot,oldStartPoint:this.annot.getStartPoint(),oldEndPoint:this.annot.getEndPoint()};break;case 2:case 3:this.undoRedoDataRecord[r.ANNOTATION.SETLEADERLINELENGTH]={annot:this.annot,oldLeaderLinePoints:this.annot.getLeaderLinePoints(),oldStartPoint:this.annot.getStartPoint(),oldEndPoint:this.annot.getEndPoint()};break;case"caption":this.undoRedoDataRecord[r.ANNOTATION.UPDATECAPTIONOFFSET]={annot:this.annot,oldCaptionOffset:this.annot.getCaptionOffset()}}else this.undoRedoDataRecord[r.ANNOTATION.UPDATEVERTEXES]={annot:this.annot,oldVertexes:this.annot.getVertexes(),oldIndex:c(t.target).data("index")}},e.prototype.boundaryChangeEnd=function(t){var n=c(t.target).data("index")||c(t.target).parent().data("index");if("line"===this.annot.getType())switch(n){case 0:case 1:var e=this.undoRedoDataRecord[r.ANNOTATION.UPDATELINEPOINTS],o=Object.assign({},e,{annot:this.annot,newStartPoint:this.annot.getStartPoint(),newEndPoint:this.annot.getEndPoint()});h(r.ANNOTATION.UPDATELINEPOINTS,o);break;case 2:case 3:var i=this.undoRedoDataRecord[r.ANNOTATION.SETLEADERLINELENGTH],a=Object.assign({},i,{annot:this.annot,newLeaderLinePoints:this.annot.getLeaderLinePoints(),newStartPoint:this.annot.getStartPoint(),newEndPoint:this.annot.getEndPoint()});h(r.ANNOTATION.SETLEADERLINELENGTH,a);break;case"caption":var u=this.undoRedoDataRecord[r.ANNOTATION.UPDATECAPTIONOFFSET],s=Object.assign({},u,{annot:this.annot,newCaptionOffset:this.annot.getCaptionOffset()});h(r.ANNOTATION.UPDATECAPTIONOFFSET,s)}else{var f=this.undoRedoDataRecord[r.ANNOTATION.UPDATEVERTEXES],l=Object.assign({},f,{annot:this.annot,newVertexes:this.annot.getVertexes(),newIndex:n});h(r.ANNOTATION.UPDATEVERTEXES,l)}},e.prototype.setContent=function(n){var e=this,o=this.annot.getContent();return t.prototype.setContent.call(this,n).then((function(t){var n=e.annot.getContent();if(n!==o)if("freetext"===e.annot.getType()){var i=e.annot.getInnerRect(),a=e.annot.getRect(),u=e.annot.getCalloutLinePoints();h(r.ANNOTATION.SETCONTENT,{annot:e.annot,oldContent:o,newContent:n,oldInnerRect:e.oldInnerRect,newInnerRect:i,oldRect:e.oldRect,newRect:a,oldCalloutLinePoints:e.oldCalloutLinePoints,newCalloutLinePoints:u})}else h(r.ANNOTATION.SETCONTENT,{annot:e.annot,oldContent:o,newContent:n});return t}))},e.prototype.placeRedact=function(n){return t.prototype.placeRedact.call(this,n).then((function(t){var n=[];return t.map((function(t){var e=t[0];n.push(e)})),h(r.ANNOTATION.PLACEREDACT,{redacts:n}),t}))},e.prototype.setDefaultAppearance=function(n,e){var o=this,i=this.annot.getDefaultAppearance();return t.prototype.setDefaultAppearance.call(this,n,e).then((function(t){var n=o.annot.getDefaultAppearance();h(r.ANNOTATION.DEFAULTAP,{annot:o.annot,oldDA:i,newDA:n})}))},e}(p)})),this.bindEvent()},t.prototype.bindEvent=function(){var t=this.controller,n=this.pdfViewer;function e(n,e){t.create("annot",n,e)}n.eventEmitter.on(f.addReplySuccess,(function(t,n){"sound"!==t.info.type&&e(r.ANNOTATION.ADDREPLY,{annot:t,replyAnnot:n})})),n.eventEmitter.on(f.deleteReplySuccess,(function(t,n){e(r.ANNOTATION.DELETEREPLY,{annot:t,replyAnnot:n})})),n.eventEmitter.on(f.addActionSuccess,(function(t){e(r.ANNOTATION.ADDACTION,{annot:t})})),n.eventEmitter.on(f.eraserSuccess,(function(t,n){e(r.ANNOTATION.ERASER,{beforeInks:t,afterInks:n})})),n.eventEmitter.on(f.addAnnotSuccess,(function(t){e(r.ANNOTATION.ADDANNOT,{annot:t})})),n.eventEmitter.on(f.applyRedaction,(function(n){t.clear()})),n.eventEmitter.on(f.addContentSuccess,(function(t,n,o){e(r.ANNOTATION.SETCONTENT,{annot:t,oldContent:n,newContent:o})})),n.eventEmitter.on(f.cancelAddAnnot,(function(){t.popUndoStack()})),n.eventEmitter.on("markRedactAnnotSuccess",(function(t){e(r.ANNOTATION.MARKREDACTANNOT,{annot:t})})),n.eventEmitter.on("makeRedactByPagesSuccess",(function(t){e(r.ANNOTATION.MAKEREDACTBYPAGES,{redacts:t})})),n.eventEmitter.on(f.markRedactionSuccess,(function(t){e(r.ANNOTATION.MARKCHECKEDRESULTREDACTION,{redacts:t})})),n.eventEmitter.on(f.addReviewStateSuccess,(function(t,n){"sound"!==t.info.type&&e(r.ANNOTATION.ADDREVIEWSTATE,{annot:t,stateName:n.getState()})})),n.eventEmitter.on(f.annotationMarkedStateAnnotAdd,(function(t,n,o){o||e(r.ANNOTATION.ADD_MARKED_STATE,{annot:n,stateName:t.getState()})})),n.eventEmitter.on(f.moveAnnotsToPages,(function(t,n,o,i){i&&e(r.ANNOTATION.moveAnnotsCrossPage,{srcPage:t,destPage:n,annots:o})}));var o=function(){return t.clear()};n.eventEmitter.on(f.importPages,o),n.eventEmitter.on(f.pageAdded,o),n.eventEmitter.on(f.pageRemoved,o),n.eventEmitter.on(f.pagesRemoved,o),n.eventEmitter.on(f.pageRotationChange,o),n.eventEmitter.on(f.pagesRotated,o),n.eventEmitter.on(f.pageMoved,o),n.eventEmitter.on(f.pagesMoved,o)},t}();n.default=l},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ANNOTATION={SETCOLOR:"ANNOTATIONSETCOLOR",SETOPACITY:"ANNOTATIONSETOPACITY",SETFILLCOLOR:"ANNOTATIONSETFILLCOLOR",SETBORDERWIDTH:"ANNOTATIONSETBORDERWIDTH",SETBORDERSTYLE:"ANNOTATIONSETBORDERSTYLE",SETENDINGSTYLE:"ANNOTATIONSETENDINGSTYLE",ENABLECAPTION:"ANNOTATIONENABLECAPTION",SETROTATION:"ANNOTATIONSETROTATION",SETHIGHLIGHTINGMODE:"ANNOTATIONSETHIGHLIGHTINGMODE",REMOVEANNOT:"REMOVEANNOT",ADDANNOT:"ADDANNOT",SETRECT:"ANNOTATIONSETRECT",MOVETO:"ANNOTATION_MOVE_TO",ANNOT_SET_RECT:"ANNOTATION_SET_RECT",UPDATEQUADPOINTSBYCHARINDEX:"UPDATEQUADPOINTSBYCHARINDEX",UPDATECALLOUTPOINTS:"ANNOTATIONUPDATECALLOUTPOINTS",UPDATELINEPOINTS:"ANNOTATIONUPDATELINEPOINTS",SETLEADERLINELENGTH:"ANNOTATIONSETLEADERLINELENGTH",UPDATEVERTEXES:"ANNOTATIONUPDATEVERTEXES",SETCONTENT:"ANNOTATIONSETCONTENT",PLACEREDACT:"ANNOTATIONPLACEREDACT",ADDREPLY:"ANNOTATIONADDREPLY",DELETEREPLY:"ANNOTATIONDELETEREPLY",ADDACTION:"ANNOTATIONADDACTION",ERASER:"ANNOTATIONERASER",MARKREDACTANNOT:"ANNOTATIONMARKREDACTANNOT",MAKEREDACTBYPAGES:"ANNOTATIONMAKEREDACTBYPAGES",MARKCHECKEDRESULTREDACTION:"MARKCHECKEDRESULTREDACTION",ADDREVIEWSTATE:"ADDREVIEWSTATE",ADD_MARKED_STATE:"ADD_MARKED_STATE",DEFAULTAP:"DEFAULTAP",moveAnnotsCrossPage:"moveAnnotsCrossPage",UPDATECAPTIONOFFSET:"ANNOTATIONUPDATECAPTIONOFFSET"}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o,r=function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n.default=t,n}(e(0)),i=e(5),a=e(18),u=(o=a)&&o.__esModule?o:{default:o};function s(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function c(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n}function f(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):function(t,n){for(var e=Object.getOwnPropertyNames(n),o=0;o<e.length;o++){var r=e[o],i=Object.getOwnPropertyDescriptor(n,r);i&&i.configurable&&void 0===t[r]&&Object.defineProperty(t,r,i)}}(t,n))}var l=function(t){function n(){return s(this,n),c(this,t.apply(this,arguments))}return f(n,t),n.getName=function(){return"undo-redo"},n.getLoader=function(){return u.default},n.prototype.init=function(n){var e=this;t.prototype.init.call(this,n),this.addonPromise=n.getPDFViewer().then((function(t){if(!t.collaborationOptions||!t.collaborationOptions.enable)return e.addon=new i.UndoRedoAddon(t),e.addon.init(),e.addon}))},n.prototype.receiveAction=function(t,n){return this.addonPromise.then((function(e){if(!e)throw new Error("undo/redo is not supported when collaboration is enabled!");return e[t](n)}))},n}(r.UIXAddon);n.default=l},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UndoRedoAddon=void 0;var o,r=e(6),i=(o=r)&&o.__esModule?o:{default:o};n.UndoRedoAddon=i.default},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n.default=t,n}(e(0)),r=u(e(7)),i=u(e(9)),a=u(e(2));function u(t){return t&&t.__esModule?t:{default:t}}var s=o.UIEvents,c=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.pdfViewer=n}return t.prototype.init=function(){var t=this,n=this.undoRedoManager=new r.default(this.pdfViewer),e=this.controller=new i.default(this.pdfViewer,n);new a.default(this.pdfViewer,e).init();var o=this.pdfViewer.getKeyboardEventBinder("pdf-viewer-keyboard-event-binder");function u(t){return"true"===t.contentEditable||"TEXTAREA"===t.tagName||"input"===t.tagName&&"text"===t.type}this.removeUndo=o.before("undo",(function(n){u(n.nativeEvent.target)||(n.preventDefault(),t.undo())})),this.removeRedo=o.before("redo",(function(n){u(n.nativeEvent.target)||(n.preventDefault(),t.redo())})),this.pdfViewer.eventEmitter.on(s.willCloseDocument,(function(){e.clear()}))},t.prototype.undo=function(){this.controller.undo()},t.prototype.redo=function(){this.controller.redo()},t.prototype.undoAll=function(){return this.controller.undoAll()},t}();n.default=c},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});r(e(2));var o=r(e(8));function r(t){return t&&t.__esModule?t:{default:t}}var i=function(){function t(n,e){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.pdfViewer=n,this.controller=e,this.undoStack=new o.default,this.redoStack=new o.default}return t.prototype.storage=function(t){var n=this;return this.undoStack.push(t),function(){var e=n.undoStack.indexOf(t);e>-1&&n.undoStack.splice(e,1)}},t.prototype.mergeLast=function(t){var n=this,e=this.undoStack.pop();if(e){var o=this.doMerge(e,t);return this.undoStack.push(o),function(){var t=n.undoStack.indexOf(o);t>-1&&(n.undoStack[t]=e)}}return this.storage(t)},t.prototype.doMerge=function(t,n){return{undo:function(){return Promise.resolve(t.undo()).finally((function(){return n.undo()}))},redo:function(){return Promise.resolve(t.redo()).finally((function(){return n.redo()}))}}},t.prototype.undo=function(){var t=this.undoStack.pop();if(t)return this.redoStack.push(t),t},t.prototype.redo=function(){var t=this.redoStack.pop();if(t)return this.undoStack.push(t),t},t.prototype.removeById=function(t){this.undoStack.filter((function(n){return t!==n.uniqueId})),this.redoStack.filter((function(n){return t!==n.uniqueId}))},t.prototype.clear=function(){this.undoStack.clear(),this.redoStack.clear()},t.prototype.getUndoStack=function(){return this.undoStack},t.prototype.getRedoStack=function(){return this.redoStack},t}();n.default=i},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.stackArray=[]}return t.prototype.push=function(t){this.stackArray.push(t)},t.prototype.pop=function(){return this.stackArray.pop()},t.prototype.size=function(){return this.stackArray.length},t.prototype.clear=function(){var t=this,n=this.stackArray,e=[];return this.stackArray=e,function(){t.stackArray===e&&(t.stackArray=n)}},t.prototype.filter=function(t){this.stackArray=this.stackArray.filter(t)},t}();n.default=o},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=i(e(10)),r=i(e(17));function i(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(n,e){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.pdfViewer=n,this.undoRedoManager=e,this.annoutInitStatesManager={};var i=Promise.resolve();this.interpreter={annot:new o.default(n),user:new r.default(n),undo:function(t){return i=i.finally((function(){return t.undo()}))},redo:function(t){i=i.finally((function(){return t.redo()}))}}}return t.prototype.before=function(t,n,e){this.beforeData={type:t,fnName:n,data:e}},t.prototype.after=function(t,n,e){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=this.beforeData;r.type===t||r.fnName===n?this.create(t,n,Object.assign(r.data,e),o):this.beforeData=null},t.prototype.create=function(t,n,e){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];1===Object.keys(e).length&&e.annot&&(this.annoutInitStatesManager[e.annot.objectNumber]=e.annot);var r=this.interpreter[t][n](e),i=void 0;i=o?this.undoRedoManager.mergeLast(r):this.undoRedoManager.storage(r);var a=this.undoRedoManager.getRedoStack().clear();return function(){i(),a()}},t.prototype.clear=function(){this.undoRedoManager.clear(),this.annoutInitStatesManager={}},t.prototype.undo=function(){var t=this.undoRedoManager.undo();t&&this.interpreter.undo(t)},t.prototype.redo=function(){var t=this.undoRedoManager.redo();t&&this.interpreter.redo(t)},t.prototype.popUndoStack=function(){this.undoRedoManager.getUndoStack().pop()},t.prototype.undoAll=function(){for(var t in this.annoutInitStatesManager){var n=this.annoutInitStatesManager[t],e=this.pdfViewer.getAnnotRender(n.page.info.index,n.objectNumber);e&&e.component&&e.component.hideUI()}for(var o=this,r="",i=[];r=this.undoRedoManager.undo();)!function(t){i.push((function(){return o.interpreter.undo(t)}))}(r);return i.reduce((function(t,n){return t.then((function(){return n()}))}),Promise.resolve())},t}();n.default=a},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,n){var e=[],o=!0,r=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(o=(a=u.next()).done)&&(e.push(a.value),!n||e.length!==n);o=!0);}catch(t){r=!0,i=t}finally{try{!o&&u.return&&u.return()}finally{if(r)throw i}}return e}(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=e(3),i=function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n.default=t,n}(e(0)),a=s(e(11)),u=s(e(12));e(13);function s(t){return t&&t.__esModule?t:{default:t}}i.PDFViewCtrl.Consts.Intents;var c=i.PDFViewCtrl.shared.QueuedAsyncTaskExecutor,f=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.pdfViewer=n}return t.prototype[r.ANNOTATION.SETCOLOR]=function(t){var n=t.annot,e=t.oldColor,o=t.newColor,r=this.pdfViewer;function i(t){return function(){var e=l(r,n);return-1===t&&(t=0),e.annot.setBorderColor(t).then((function(){e.updateRender()}))}}return{undo:i(e),redo:i(o)}},t.prototype[r.ANNOTATION.SETOPACITY]=function(t){var n=t.annot,e=t.oldOpacity,o=t.newOpacity,r=this.pdfViewer;function i(t){return function(){var e=l(r,n);return e.annot.setOpacity(t).then((function(){e.updateRender()}))}}return{undo:i(e),redo:i(o)}},t.prototype[r.ANNOTATION.SETFILLCOLOR]=function(t){var n=t.annot,e=t.oldFillColor,o=t.newFillColor,r=this.pdfViewer;function i(t){return function(){var e=l(r,n);(e.annot.setStyleFillColor||e.annot.setFillColor).call(e.annot,t)}}return{undo:i(e),redo:i(o)}},t.prototype[r.ANNOTATION.SETBORDERWIDTH]=function(t){var n=t.annot,e=t.oldBorderWidth,o=t.newBorderWidth,r=this.pdfViewer;function i(t){return function(){return l(r,n).annot.setBorderWidth(t)}}return{undo:i(e),redo:i(o)}},t.prototype[r.ANNOTATION.SETBORDERSTYLE]=function(t){var n=t.annot,e=t.oldBorderStyle,o=t.newBorderStyle,r=this.pdfViewer;function i(t){return function(){return l(r,n).annot.setBorderStyle(t.style,t.param)}}return{undo:i(e),redo:i(o)}},t.prototype[r.ANNOTATION.SETENDINGSTYLE]=function(t){var n=t.annot,e=t.isStart,o=t.oldStyle,r=t.newStyle,i=this.pdfViewer;function a(t){return function(){var o=l(i,n);return o.annot.setCalloutLineEndingStyle?o.annot.setCalloutLineEndingStyle(+t).then((function(){o.redraw(),o.activeRect()})):o.annot.setEndingStyle(e,+t).then((function(){o.redraw(),o.activeRect()}))}}return{undo:a(o),redo:a(r)}},t.prototype[r.ANNOTATION.ENABLECAPTION]=function(t){var n=t.annot,e=t.oldEnableCaption,o=t.newEnableCaption,r=this.pdfViewer;function i(t){return function(){return l(r,n).annot.enableCaption(t)}}return{undo:i(e),redo:i(o)}},t.prototype[r.ANNOTATION.SETROTATION]=function(t){var n=t.annot,e=t.oldRotation,o=t.newRotation,r=t.oldRect,i=t.newRect,a=this.pdfViewer;function u(t,e){return function(){var o=l(a,n);return"screen"===n.getType()?o.annot.setRect(e).then((function(n){if(n)return o.annot.setRotation((t+360)%360).then((function(){o.activeRect()}))})):o.annot.setRotation((t+360)%360).then((function(){o.activeRect()}))}}return{undo:u(e,r),redo:u(o,i)}},t.prototype[r.ANNOTATION.SETHIGHLIGHTINGMODE]=function(t){var n=t.annot,e=t.oldHlMode,o=t.newHlMode,r=this.pdfViewer;function i(t){return function(){return l(r,n).annot.setHighlightingMode(t)}}return{undo:i(e),redo:i(o)}},t.prototype[r.ANNOTATION.REMOVEANNOT]=function(t){var n=o(t,2),e=n[0],r=n[1],i=this.pdfViewer;return{undo:d(i,e,r),redo:p(r,i)}},t.prototype[r.ANNOTATION.ADDANNOT]=function(t){var n=t.annot,e=this.pdfViewer,o=[n],r=n.getPopup&&n.getPopup();return r&&!r.isEmpty()&&o.push(r),n.isReplace&&n.isReplace()&&(o=n.getGroupElements().map((function(t){return t}))).push(n.getGroupHeader().getPopup()),{undo:p(n,e),redo:d(e,o,n),annot:n}},t.prototype[r.ANNOTATION.UPDATEQUADPOINTSBYCHARINDEX]=function(t){var n=t.annot,e=t.oldStart,o=t.oldEnd,r=t.newStart,i=t.newEnd,a=this.pdfViewer;function u(t,e){return function(){var o=l(a,n);return o.annot.updateQuadPointsByCharIndex(t,e).then((function(){if(o.redraw(),o.isReplace)return o.caretAnnot.moveRectByCharIndex(e).then((function(){o.getGroupRenders().map((function(t){t.active()}))}));o.active()}))}}return{undo:u(e,o),redo:u(r,i)}},t.prototype[r.ANNOTATION.SETRECT]=function(t){var n=t.annot,e=t.oldRect,o=t.newRect,r=t.oldInnerRect,i=t.newInnerRect,a=this.pdfViewer;function u(t,e){return function(){var o=l(a,n);return e?o.annot.setRectAndInnerRect(t,e).then((function(){o.redraw(),o.active()})):o.annot.setRect(t).then((function(){o.redraw(),o.active()}))}}return{undo:u(e,r),redo:u(o,i)}},t.prototype[r.ANNOTATION.ANNOT_SET_RECT]=function(t){var n=t.annot,e=t.originRect,o=t.newRect,r=this.pdfViewer;function i(t){return function(){var e=l(r,n);return e.annot.setRect(t).then((function(){e.redraw(),e.active()}))}}return{undo:i(e),redo:i(o)}},t.prototype[r.ANNOTATION.MOVETO]=function(t){var n=t.annot,e=t.originLeft,o=t.originTop,r=t.left,i=t.top,a=this.pdfViewer;function u(t,e){return function(){var o=l(a,n);return o&&o.annot?o.annot.moveTo({left:t,top:e}).then((function(){o.redraw(),o.active()})):Promise.resolve()}}return{undo:u(e,o),redo:u(r,i)}},t.prototype[r.ANNOTATION.UPDATECALLOUTPOINTS]=function(t){var n=t.annot,e=t.oldRect,o=t.oldCalloutLinePoints,r=t.oldInnerRect,i=t.newRect,a=t.newCalloutLinePoints,u=t.newInnerRect,s=this.pdfViewer;function c(t,e,o){return function(){var r=l(s,n);return r.annot._setRect(t,!1).then((function(){return r.annot.setInnerRectNoAction(o).then((function(){return r.annot.setCalloutLinePoints(e).then((function(){return r.annot.update().then((function(){r.redraw(),r.active()}))}))}))}))}}return{undo:c(e,o,r),redo:c(i,a,u)}},t.prototype[r.ANNOTATION.UPDATELINEPOINTS]=function(t){var n=t.annot,e=t.oldStartPoint,o=t.oldEndPoint,r=t.newStartPoint,i=t.newEndPoint,a=this.pdfViewer;function u(t,e){return function(){var o=[],r=l(a,n);return o.push(r.annot.setStartPoint(t)),o.push(r.annot.setEndPoint(e)),Promise.all(o).then((function(){r.active()}))}}return{undo:u(e,o),redo:u(r,i)}},t.prototype[r.ANNOTATION.SETLEADERLINELENGTH]=function(t){var n=t.annot,e=t.oldLeaderLinePoints,o=t.oldStartPoint,r=t.oldEndPoint,i=t.newLeaderLinePoints,a=t.newStartPoint,u=t.newEndPoint,s=this.pdfViewer;function c(t,e,o){var r=t.start,i=(t.end,Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))),a=!0;return(o.x-e.x)*(r.y-o.y)-(r.x-o.x)*(o.y-e.y)>0&&(a=!1),a&&(i=-i),function(){var t=l(s,n);return t.annot.setLeaderLineLength(i).then((function(){t.active()}))}}return{undo:c(e,o,r),redo:c(i,a,u)}},t.prototype[r.ANNOTATION.UPDATEVERTEXES]=function(t){var n=t.annot,e=t.oldVertexes,o=t.oldIndex,r=t.newVertexes,i=t.newIndex,a=this.pdfViewer;function u(t,e){return function(){var o=l(a,n);return o.annot.updateVertexes(t,e[t]).then((function(){o.active()}))}}return{undo:u(o,e),redo:u(i,r)}},t.prototype[r.ANNOTATION.SETCONTENT]=function(t){var n=t.annot,e=t.oldContent,o=t.newContent,r=t.oldInnerRect,i=t.newInnerRect,a=t.oldRect,u=t.newRect,s=t.oldCalloutLinePoints,c=t.newCalloutLinePoints,f=this.pdfViewer;function d(t,e,o,r){return function(){return function(t,n){return t.getCurrentPDFDoc().getPageByIndex(n.page.getIndex()).then((function(t){return t.getAnnotsByObjectNumArray([n.objectNumber]).then((function(t){return t[0]}))}))}(f,n).then((function(n){return n.setContent(t).then((function(){return o&&n.setRect(o).then((function(){return e&&n.setInnerRect(e).then((function(){return r&&n.setCalloutLinePoints(r).then((function(){var t=l(f,n);t.redraw(),t.active()}))}))}))}))}))}}return{undo:d(e,r,a,s),redo:d(o,i,u,c)}},t.prototype[r.ANNOTATION.PLACEREDACT]=function(t){var n=t.redacts;return{undo:function(){return Promise.all(n.map((function(t){return t.getPDFPage().removeAnnot(t)})))},redo:d(this.pdfViewer,n,n[0])}},t.prototype[r.ANNOTATION.ADDREPLY]=function(t){var n=t.annot,e=t.replyAnnot,o=this.pdfViewer;return{undo:T(n,e,o),redo:h(n,e,o)}},t.prototype[r.ANNOTATION.DELETEREPLY]=function(t){var n=t.annot,e=t.replyAnnot,o=this.pdfViewer;return{undo:h(n,e,o),redo:T(n,e,o)}},t.prototype[r.ANNOTATION.ADDACTION]=function(t){var n=t.annot,e=this.pdfViewer,o=n.getAction();return{undo:function(){return n.removeAction()},redo:function(){return function(t,n){return t.setAction(n.type).then((function(){var e=new u.default(n).toJson();return t.setActionData(e).then((function(){return function t(n,e){for(var o=e.subActionCount,r=[],i=function(o){r.push(n.insertSubAction(o,e.subAction[o].type).then((function(){var r=new RecoveryAction(e.subAction[o]).toJson(),i=n.getSubAction(o);return i.setActionData(r).then((function(){return t(i,e.subAction[o])}))})))},a=0;a<o;a++)i(a);return Promise.all(r)}(t.getAction(),n)}))}))}(l(e,n).annot,o.info)}}},t.prototype[r.ANNOTATION.ERASER]=function(t){var n=t.beforeInks,e=t.afterInks,o=this.pdfViewer;return{undo:function(){var t=n.map((function(t,n){var r=t.annot,i=t.inkList;return t.isRemove?d(o,e[n].params,r,!1)().then((function(t){return l(o,r).annot.setInkList(i)})):l(o,r).annot.setInkList(i)}));return Promise.all(t)},redo:function(){var t=e.map((function(t){var n=t.annot;t.inkList;return t.isRemove?p(n,o)():l(o,t.annot).annot.setInkList(t.inkList)}));return Promise.all(t)}}},t.prototype[r.ANNOTATION.MARKREDACTANNOT]=function(t){var n=t.annot,e=this.pdfViewer,o=[n],r=n.getPopup();return r&&!r.isEmpty()&&o.push(r),{undo:p(n,e),redo:d(e,o,n)}},t.prototype[r.ANNOTATION.MAKEREDACTBYPAGES]=function(t){var n=t.redacts,e=this.pdfViewer,o=[];return n.map((function(t){o.push(new a.default(t).getJson())})),{undo:function(){return Promise.all(n.map((function(t){return t.getPDFPage().removeAnnot(t)})))},redo:d(e,n,n[0])}},t.prototype[r.ANNOTATION.MARKCHECKEDRESULTREDACTION]=function(t){var n=t.redacts,e=this.pdfViewer,o=[];return n.map((function(t){o.push(new a.default(t).getJson())})),{undo:function(){return Promise.all(n.map((function(t){return t.getPDFPage().removeAnnot(t)})))},redo:d(e,n,n[0])}},t.prototype[r.ANNOTATION.ADDREVIEWSTATE]=function(t){var n=t.annot,e=t.stateName,o=this.pdfViewer,r=n.getPDFPage(),i=n.getObjectNumber(),a=n.getReviewStates().find((function(t){return t.info.state===e}));return{undo:function(){return r.getAnnotsByObjectNumArray([i]).then((function(t){return t[0]&&t[0].removeReviewState()}))},redo:function(){return r.getAnnotsByObjectNumArray([i]).then((function(t){return function(t,n,e,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=e[0].page;return i.addReviewStateAnnotObject(n,e.map((function(t){return t.objectNumber}))).then((function(n){t.killFocus();var e=l(t,o);r&&e&&e.active()}))}(o,t[0],[a],a)}))}}},t.prototype[r.ANNOTATION.ADD_MARKED_STATE]=function(t){var n=t.annot,e=t.stateName,r=n.getReviewStates().find((function(t){return t.info.state===e}));function i(t){return n.page.getAnnotsByObjectNumArray([t]).then((function(t){return o(t,1)[0]}))}return{undo:function(){return i(n.objectNumber).then((function(t){return t.removeMarkedState()}))},redo:function(){return i(n.objectNumber).then((function(t){return function(t,n,e,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=e[0].page;return i.addMarkedStateAnnotObject(n,e.map((function(t){return t.objectNumber})),!0,!0).then((function(n){t.killFocus();var e=l(t,o);r&&e&&e.active()}))}(pdfViewer,t,[r],r)}))}}},t.prototype[r.ANNOTATION.DEFAULTAP]=function(t){var n=t.annot,e=t.oldDA,o=t.newDA,r=this.pdfViewer;function i(t){return function(){var e=l(r,n);return e.annot.setDefaultAppearance(t).then((function(){e.active()}))}}return{undo:i(e),redo:i(o)}},t.prototype[r.ANNOTATION.moveAnnotsCrossPage]=function(t){var n=t.srcPage,e=t.destPage,o=t.annots,r=this.pdfViewer.getCurrentPDFDoc(),i=Object.keys(o).reduce((function(t,n){var e=o[n];return t[n]={rect:e.oldRect,oldRect:e.rect},t}),{});return{undo:function(){return r.moveAnnotsToPage(e,n,i,!0)},redo:function(){return r.moveAnnotsToPage(n,e,o,!0)}}},t.prototype[r.ANNOTATION.UPDATECAPTIONOFFSET]=function(t){var n=t.annot,e=t.oldCaptionOffset,o=t.newCaptionOffset,r=this.pdfViewer;function i(t){return function(){var e=l(r,n);return e.annot.setCaptionOffset(t.x,t.y).then((function(){e.active()}))}}return{undo:i(e),redo:i(o)}},t}();function l(t,n){var e=t.getAnnotRender(n.page.getIndex(),n.objectNumber);return e?e.component:null}function d(t,n,e){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!(n.length<1)){var r=n[0].page;return function(){return r.addAnnotObjects(n.map((function(t){return t.objectNumber}))).then((function(n){t.killFocus();var r=l(t,e);o&&r&&r.active()}))}}}function p(t,n){return function(){n.activeElement();var e=l(n,t);return e&&e.annot&&e.annot.getPDFPage().removeAnnot(e.annot).then((function(t){var o=n.getCurrentActivatable();return o&&o.remove&&o.remove(e),t}))}}function h(t,n,e){return function(){var e=t.page;return e.addAnnotObjects([n.objectNumber],!1).then((function(o){t=e.annotIdMap[t.objectNumber];var r=n.reviewStates;if(r.length>0){var i=[];r.map((function(t){i.push(t.info.state)})),function(t,n){var e=new c;n.forEach((function(n){e.exec((function(){return t.addReviewState(n)}))})),e.waitForCurrentRunningTasks()}(o[0],i)}t.info.repliesSummary.some((function(t){return t.objectNumber==n.objectNumber}))||(t.info.repliesSummary.push({objectNumber:o[0].info.objectNumber,id:o[0].info.objectNumber,index:o[0].info.index}),t.replies.push(o[0])),e.doc.engine.eventEmitter.emit("annotation-reply-add",o[0],t),e.doc.engine.eventEmitter.emit("annotation-updated",[t],e,"add-replies")}))}}function T(t,n,e){return function(){return t.getPDFPage().removeAnnot(n)}}n.default=f},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n.default=t,n}(e(0)).PDFViewCtrl.Consts.BORDER_STYLE,r=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(t){var n,e,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"HTML",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a="",u=void 0;"number"==typeof t&&(t=["int",t]);switch(t[0]){case"int":n=(16711680&t[1])>>16,e=(65280&t[1])>>8,o=255&t[1];break;case"T":n=0,e=0,o=0,i=0;break;case"G":n=e=o=255*t[1];break;case"RGB":n=255*t[1],e=255*t[2],o=255*t[3];break;case"CMYK":n=(1-t[4])*(1-t[1])*255,e=(1-t[4])*(1-t[2])*255,o=(1-t[4])*(1-t[3])*255;break;case"r":u=t.match(/rgba?\((\d*),\s*(\d*),\s*(\d*),?\s*([\.0-9]*)?\)/),n=+u[1],e=+u[2],o=+u[3];break;case"#":var s=4==t.length?/#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])$/:/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/;u=t.match(s),n=parseInt(u[1],16),e=parseInt(u[2],16),o=parseInt(u[3],16);break;default:throw new Error("Unsupported color format")}switch(r){case"HTML":a=n===e&&e===o&&-1===o?"transparent":"rgba("+parseInt(n)+","+parseInt(e)+","+parseInt(o)+","+i+")";break;case"RGB":a=["RGB",n/255,e/255,o/255];break;case"#":a+=n<16?"#0"+n.toString(16):"#"+n.toString(16),a+=e<16?"0"+e.toString(16):e.toString(16),a+=o<16?"0"+o.toString(16):o.toString(16);break;case"int":a=0,a|=(i*=255)<<24,a|=n<<16,a|=e<<8,a|=o,a>>>=0}return a}(n.info.borderColor,"int");this.json={objectNumber:n.info.objectNumber,name:n.getName(),flags:n.info.flag,rect:n.info.rect,color:e,style:n.info.borderInfo.style,contents:n.info.content,date:new Date(n.info.modifiedTimestamp).getTime(),type:n.info.type,borderWidth:n.info.borderInfo.width},n.info.isMarkup&&this.markup(n);var o=n.info.type;switch("strikeout"!==o&&"highlight"!==o&&"squiggly"!==o&&"underline"!==o||this.textMarkup(n),o){case"ink":this.ink(n);break;case"fileattachment":this.fileattachment(n);break;case"polygon":this.polygon(n);break;case"polyline":this.polyline(n);break;case"stamp":this.stamp(n);break;case"freetext":this.freetext(n);break;case"screen":this.screen(n);break;case"line":this.line(n);break;case"redact":this.redact(n);break;case"highlight":this.highlight(n);break;case"link":this.link(n);break;case"square":this.square(n);break;case"circle":this.circle(n)}}return t.prototype.markup=function(t){var n="",e=!1;if(t.getPopup){var o=t.getPopup();o?(n=o.getName(),e=!1):e=!0}else e=!0;this.json=Object.assign({intent:t.info.intent,opacity:t.info.opacity,subject:t.info.subject,title:t.info.title,creationTimestamp:new Date(t.info.creationTimestamp).getTime(),popId:n,noPopup:e},this.json)},t.prototype.textMarkup=function(t){var n=[];t.info.quadPoints.map((function(t){n.push({top:t[0].y,left:t[0].x,bottom:t[3].y,right:t[3].x})})),this.json=Object.assign(this.json,{coords:n})},t.prototype.ink=function(t){this.json=Object.assign({inkList:t.info.inkList},this.json)},t.prototype.fileattachment=function(t){this.json=Object.assign({fObjNum:t.info.fObjNum},this.json)},t.prototype.polygon=function(t){var n=i(t.info.borderInfo),e=t.info.measureRatio,o=t.info.measureUnit,r=null;e&&o&&(r={unit:o,ratio:e}),this.json=Object.assign(this.json,{vertexes:t.info.vertexes,borderStyle:n.style,borderStyleParam:n.param,fillColor:t.info.fillColor,style:void 0,measure:r})},t.prototype.polyline=function(t){var n=i(t.info.borderInfo),e=t.info.measureRatio,o=t.info.measureUnit,r=null;e&&o&&(r={unit:o,ratio:e}),this.json=Object.assign(this.json,{vertexes:t.info.vertexes,fillColor:t.info.fillColor,borderStyle:n.style,borderStyleParam:n.param,style:void 0,startStyle:t.info.startStyle,endStyle:t.info.endingStyle,measure:r})},t.prototype.stamp=function(t){this.json=Object.assign({icon:t.info.icon,rotate:(t.info.rotation+360)%360,apObjeNum:t.info.apObjeNum},this.json)},t.prototype.freetext=function(t){var n=i(t.info.borderInfo),e="FreeTextTypewriter"==t.info.intent?0:t.info.fillColor;this.json=Object.assign(this.json,{calloutLinePoints:t.info.calloutLinePoints,innerRect:t.info.innerRect,borderStyle:n.style,borderStyleParam:n.param,style:void 0,"interior-color":e,calloutLineEndingStyle:t.info.calloutLineEndingStyle,defaultAppearance:t.info.defaultAppearance,rotate:t.info.rotation})},t.prototype.line=function(t){var n=i(t.info.borderInfo),e=t.info.measureRatio,o=t.info.measureUnit,r=null;e&&o&&(r={unit:o,ratio:e});var a=t.info.startPoint,u=t.info.endPoint;this.json=Object.assign(this.json,{styleFillColor:t.info.styleFillColor,startStyle:t.info.startStyle,endStyle:t.info.endingStyle,enableCaption:t.info.hasCaption,startPoint:{x:a.x,y:a.y},endPoint:{x:u.x,y:u.y},measure:r,borderStyle:n.style,borderStyleParam:n.param,style:void 0})},t.prototype.screen=function(t){var n=i(t.info.borderInfo);this.json=Object.assign({apObjNum:t.info.apObjNum,opacity:t.info.opacity,rotate:{0:0,90:1,180:2,270:3}[t.info.rotation],iObjNum:t.info.iObjNum,aObjNum:t.info.aObjNum,intensity:n.param},this.json)},t.prototype.redact=function(t){var n=t.info.quadPoints,e=[];n.length>0?n.map((function(t){e.push({left:t[0].x,right:t[3].x,top:t[0].y,bottom:t[3].y})})):e.push(t.info.rect),this.json=Object.assign(this.json,{rects:e,applyFillColor:t.info.applyFillColor})},t.prototype.highlight=function(t){t.info.isArea&&(this.json=Object.assign(this.json,{coords:[t.info.rect],dicts:{AreaHi:"AreaHi"}}),delete this.json.startCharIndex,delete this.json.endCharIndex)},t.prototype.link=function(t){var n=i(t.info.borderInfo);this.json=Object.assign(this.json,{aObjNum:t.info.aObjNum,borderStyle:n.style,borderStyleParam:n.param,style:void 0,highlightingMode:t.info.highlightingMode})},t.prototype.circle=function(t){var n=i(t.info.borderInfo),e=t.info.measureRatio,o=t.info.measureUnit,r=null;e&&o&&(r={unit:o,ratio:e}),this.json=Object.assign(this.json,{fillColor:t.info.fillColor,borderStyle:n.style,borderStyleParam:n.param,style:void 0,measure:r})},t.prototype.square=function(t){var n=i(t.info.borderInfo),e=t.info.measureRatio,o=t.info.measureUnit,r=null;e&&o&&(r={unit:o,ratio:e}),this.json=Object.assign(this.json,{fillColor:t.info.fillColor,measure:r,borderStyle:n.style,borderStyleParam:n.param,style:void 0})},t.prototype.getJson=function(){return this.json},t}();function i(t){var n=t.style,e=t.cloudIntensity,r=t.dashes,i=void 0;switch(n){case o.SOLID:i=[];break;case o.CLOUDY:i=e;break;case o.DASHED:i=r}return{style:n,param:i}}n.default=r},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.action=n,this.json={},this[n.type]()}return t.prototype.TypeGoto=function(){var t=this.action.destination;this.json=Object.assign(t,{type:t.zoomMode})},t.prototype.TypeURI=function(){var t=this.action.uri;this.json=Object.assign({},{uri:t})},t.prototype.TypeJavaScript=function(){var t=this.action.javascript;this.json=Object.assign({},{script:t})},t.prototype.TypeNamed=function(){var t=this.action.name;this.json=Object.assign({},{name:t})},t.prototype.TypeHide=function(){var t=this.action,n=t.fieldNames,e=t.hideState;this.json=Object.assign({},{fieldNames:n,hideState:e})},t.prototype.TypeSubmitForm=function(){var t=this.action,n=t.flags,e=t.url,o=t.fieldNames;this.json=Object.assign({},{flags:n,url:e,fieldNames:o})},t.prototype.TypeResetForm=function(){var t=this.action,n=t.flags,e=t.fieldNames;this.json=Object.assign({},{flags:n,fieldNames:e})},t.prototype.TypeGoToR=function(){var t=this.action,n=t.destinationName,e=t.destination;this.json=Object.assign({},{destinationName:n,destination:e})},t.prototype.toJson=function(){return this.json},t}();n.default=o},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SerialEnhancePromise=n.SerialPromise=n.DebounceAsyncTaskExecutor=n.DebouncePromiseQueue=void 0;var o,r=e(1),i=(o=r)&&o.__esModule?o:{default:o},a=e(14),u=e(16);function s(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var c=function(){},f=function(){function t(){s(this,t),this.queue=[],this.promise=Promise.resolve()}return t.prototype.push=function(t){var n=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return this.queue.push([t,e]),new Promise((function(t,e){setTimeout((function(){return n.exec()}),o)}))},t.prototype.exec=function(){var t=this;if(!this.execIng){var n=this.queue.pop();if(n){this.execIng=!0;for(var e=0,o=this.queue.length;e<o;e++)this.queue[e][1]();return this.queue=[],Promise.resolve(n[0]()).catch((function(){try{return Promise.resolve(n[1]()).catch(c)}catch(t){}})).finally((function(){t.execIng=!1,setTimeout((function(){t.exec()}),30)}))}}},t.prototype.end=function(){this.queue=[]},t}(),l=function(){function t(){s(this,t),this.executor=new u.QueuedAsyncTaskExecutor}return t.prototype.serial=function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.executor.cancel(),this.executor.waitForCurrentRunningTasks().then((function(){return t.executor.resume(),t.executor.execTasks(n.map((function(t){return{task:t}})))}))},t.prototype.push=function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];return this.executor.execTasks(n.map((function(t){return{task:t}})))},t.prototype.unshift=function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];return this.executor.insert(n.map((function(t){return{task:t}}))),this.executor.waitForCurrentRunningTasks()},t.prototype.concat=function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return n.forEach((function(n){t.executor.exec(n)})),this.executor.waitForCurrentRunningTasks()},t.prototype.exec=function(){return this.executor.waitForCurrentRunningTasks()},t.prototype.end=function(){return this.executor.cancel(),this.executor.waitForCurrentRunningTasks()},t}(),d=function(){function t(){s(this,t),this.queue=[],this.continueExec=!0,this.deferred=(0,i.default)(),this.task=Promise.resolve()}return t.prototype.serial=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.queue=t,this.exec(),this.deferred.promise},t.prototype.push=function(){this.queue.push.apply(this.queue,arguments)},t.prototype.unshift=function(){this.queue.unshift.apply(this.queue,arguments)},t.prototype.concat=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.queue.concat(t)},t.prototype.exec=function(){var t=this;if(!this.execIng){this.execIng=!0;var n=this.queue.shift()||[c],e=n[0]();return this.execIngEnd=n[1]||c,Promise.resolve(e).finally((function(){return t.execIng=!1,t.queue.length?t.continueExec?void t.task.then((function(n){return t.exec()})):(t.queue=[],t.deferred.resolve(e)):t.deferred.resolve(e)})).catch(c),this.deferred.promise}},t.prototype.end=function(){if(this.execIng)try{Promise.resolve(this.execIngEnd()).catch(c)}catch(t){}return this.continueExec=!1,this.queue=[],this.deferred.promise},t}();n.DebouncePromiseQueue=f,n.DebounceAsyncTaskExecutor=a.DebounceAsyncTaskExecutor,n.SerialPromise=l,n.SerialEnhancePromise=d},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DebounceAsyncTaskExecutor=void 0;var o=function(){function t(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(n,e,o){return e&&t(n.prototype,e),o&&t(n,o),n}}(),r=a(e(1)),i=a(e(15));function a(t){return t&&t.__esModule?t:{default:t}}function u(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}n.DebounceAsyncTaskExecutor=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;u(this,t),this.interval=n,this.status=t.STATUS_IDLE,this.defer=(0,r.default)(),this.lastTaskPromise=null,this.cancelLast=i.default}return o(t,null,[{key:"STATUS_IDLE",get:function(){return"idle"}},{key:"STATUS_RUNNING",get:function(){return"running"}},{key:"STATUS_READY",get:function(){return"ready"}},{key:"STATUS_CANCELED",get:function(){return"canceled"}},{key:"STATUS_DESTROYED",get:function(){return"destroyed"}}]),t.prototype.exec=function(n,e,o){var i=this;if(this.status!==t.STATUS_DESTROYED){switch(this.status){case t.STATUS_IDLE:case t.STATUS_READY:this.cancelLast();var a=setTimeout((function(a){if(i.status!==t.STATUS_DESTROYED)if(i.status!==t.STATUS_CANCELED){i.status=t.STATUS_RUNNING;var u=i.defer,s=u.resolve,c=u.reject,f=function(){i.status=t.STATUS_IDLE,i.defer=(0,r.default)()};try{var l=n.apply(o,e||[]);l instanceof Promise?l.finally(f).then(s,c):(s(l),f())}catch(n){c(n),i.status=t.STATUS_IDLE}}else i.status=t.STATUS_IDLE}),this.interval);this.cancelLast=function(){clearTimeout(a)};break;case t.STATUS_RUNNING:var u=function(){switch(i.status){case t.STATUS_IDLE:i.status=t.STATUS_READY;break;case t.STATUS_CANCELED:return void(i.status=t.STATUS_IDLE);case t.STATUS_DESTROYED:return}return i.exec(n,e,o)};return this.lastTaskPromise=this.defer.promise.then(u,u)}return this.lastTaskPromise=this.defer.promise}},t.prototype.waitForLastTask=function(t){return this.lastTaskPromise||Promise.resolve(t)},t.prototype.cancel=function(){this.status=t.STATUS_CANCELED},t.prototype.destroy=function(){this.status=t.STATUS_DESTROYED},t}()},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){}},function(t,n,e){"use strict";e.r(n),e.d(n,"ExecutionContext",(function(){return u})),e.d(n,"QueuedAsyncTaskExecutor",(function(){return s}));var o=e(1),r=e.n(o),i=function(t,n){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var o,r,i=e.call(t),a=[];try{for(;(void 0===n||n-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(r)throw r.error}}return a},a=function(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(i(arguments[n]));return t},u=function(){function t(t){this.task=t,this.cancelled=!1,this.defer=r()()}return t.prototype.cancel=function(){this.defer.resolve(),this.cancelled=!0},t.prototype.isCancelled=function(){return this.cancelled},Object.defineProperty(t.prototype,"promise",{get:function(){return this.defer.promise},enumerable:!1,configurable:!0}),t.prototype.reject=function(t){this.defer.reject(t)},t.prototype.resolve=function(t){this.defer.resolve(t)},t}(),s=function(){function t(){this.insertions=[],this.executions=[],this.isRunning=!1}return t.prototype.notifyExecute=function(){var t=this;if(!this.isRunning){this.isRunning=!0;var n=function(){var e,o=t.getAndPopNextExecution();if(o){var r=null===(e=t.executing)||void 0===e?void 0:e.promise,i=function(){if(t.executing=o,o.isCancelled())n();else{var e=o.task;Promise.resolve(e.task.apply(e.context,e.args||[])).then((function(t){o.resolve(t)}),(function(t){o.reject(t)})).finally((function(){n()}))}};r?r.finally(i):i()}else t.isRunning=!1};n()}},t.prototype.execTasks=function(t,n){var e,o;if(void 0===n&&(n=!1),0===t.length)return this.waitForCurrentRunningTasks();var r=t.map((function(t){return new u(t)}));n?(e=this.executions).unshift.apply(e,a(r)):(o=this.executions).push.apply(o,a(r));var i=r[r.length-1].promise;return this.notifyExecute(),i},t.prototype.execInverse=function(t,n,e){return void 0===n&&(n=1),this.exec(t,n,e,!0)},t.prototype.exec=function(t,n,e,o){void 0===n&&(n=1),void 0===o&&(o=!1);var r=("number"==typeof n?Array(n).fill(0).map((function(t,n){return[n]})):n).map((function(n){return{task:t,args:n,context:e}}));return this.execTasks(r,o)},t.prototype.insert=function(){for(var t,n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var o=n.map((function(t){return"function"==typeof t?{task:t}:t})),r=o.map((function(t){return new u(t)}));(t=this.insertions).push.apply(t,a(r));var i=Promise.all(r.map((function(t){return t.promise})));return this.notifyExecute(),i},t.prototype.resume=function(){},t.prototype.cancel=function(){var t;this.insertions.forEach((function(t){t.cancel()})),this.executions.forEach((function(t){t.cancel()})),null===(t=this.executing)||void 0===t||t.cancel()},t.prototype.waitForCurrentRunningTasks=function(){var t=this.insertions.concat(this.executions);return this.executing&&t.push(this.executing),Promise.all(t.map((function(t){return t.promise})))},t.prototype.getRunningTaskCount=function(){return this.executions.filter((function(t){return!t.isCancelled()})).length},t.prototype.getAndPopNextExecution=function(){var t;return this.insertions.length>0?(t=this.insertions[0],this.insertions.shift()):this.executions.length>0&&(t=this.executions[0],this.executions.shift()),t},t}()},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.pdfViewer=n}return t.prototype.add=function(t,n){this[t]=n},t}();n.default=o},function(t,n){t.exports=null}]).default}));